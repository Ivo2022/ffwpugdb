{% extends "admin/base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
      <!-- Sidebar-style navigation -->
      <div class="row mb-4">
        <div class="col-12">
            <h4 class="mb-4">Donations Records</h4>
            <ul class="list-group list-group-horizontal-md">
                <li class="list-group-item"><a href="/admin/dashboard" class="text-decoration-none">Dashboard</a></li>
                <li class="list-group-item"><a href="/members" class="text-decoration-none">Members</a></li>
                <li class="list-group-item"><a href="/donation" class="text-decoration-none">Donations</a></li>
                <li class="list-group-item"><a href="/attendance" class="text-decoration-none">Attendance</a></li>
                <li class="list-group-item"><a href="/member/dashboard" class="text-decoration-none">My Dashboard</a></li>
            </ul>
        </div>
    </div>
    <a href="/donation/create" class="btn btn-success">+ Add Donation</a>
  </div>

  <!-- Search -->
  <form method="get" action="/donation" class="mb-3 d-flex">
    <input
      type="text"
      class="form-control me-2"
      name="q"
      value="{{ q }}"
      placeholder="Search donations..."
    />
    <div class="col-md-3 me-2">
        <select name="page_size" class="form-select">
          {% for n in [5,10,20,50] %}
            <option value="{{ n }}" {% if n == page_size %}selected{% endif %}>{{ n }} / page</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-outline-primary w-100">Filter</button>
      </div>
    <!--<button class="btn btn-primary">Search</button>-->
  </form>

  <!-- Counts -->
  {% set start = (page - 1) * page_size + 1 if total > 0 else 0 %}
  {% set end = total if page * page_size > total else page * page_size %}
  <p class="text-muted">
    Showing <strong>{{ start }}</strong>â€“<strong>{{ end }}</strong> of <strong>{{ total }}</strong>
  </p>

  <!-- Table -->
  <table class="table table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Member Name</th>
        <th>Amount</th>
        <th>Type</th>
        <th>Date</th>
        <th>Remarks</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for d in donations %}
      <tr>
        <td>{{ loop.index + ((page - 1) * page_size) }}</td>
        <!-- Display member name -->
        <td>
            {% if d.member %}
                {{ d.member.first_name }} {{ d.member.last_name }}
            {% else %}
                Unknown
            {% endif %}
        </td>
        <td>{{ "{:,.0f}".format(d.amount) }} UGX</td>
        <td>{{ d.donation_type|capitalize }}</td>
        <td>{{ d.donation_date.strftime("%Y-%m-%d") if d.donation_date else "" }}</td>
        <td>{{ d.remarks }}</td>
        <td>
          <a href="/donation/{{ d.id }}/edit" class="btn btn-sm btn-warning">Edit</a>
          <form action="/donation/{{ d.id }}/delete" method="post" style="display:inline">
            <button class="btn btn-sm btn-danger" onclick="return confirm('Delete donation?')">Delete</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-center">
          No donations found.
          <a href="/donation/create" class="btn btn-link">Add a donation</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  <nav>
    <ul class="pagination">
      {% for p in range(1, pages+1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="?page={{ p }}&q={{ q }}">{{ p }}</a>
      </li>
      {% endfor %}
    </ul>
  </nav>
</div>
{% endblock %}
