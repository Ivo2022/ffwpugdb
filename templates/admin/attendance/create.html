  {% extends "admin/base.html" %}
  {% block content %}
  <div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="card shadow-lg p-4 rounded-4" style="max-width: 800px; width: 100%;">
      {% if error %}
      <div class="alert alert-danger" role="alert">
          {{ error }}
      </div>
      {% endif %}
  <h2>Record Attendance</h2>
  <form method="post" action="{{ url_for('attendance_create') }}" class="row g-3">
    <div class="mb-3">
          <label for="attendance_date">Date</label>
          <input type="date" id="attendance_date" name="attendance_date" class="form-control" required>
      </div>

      <div class="mb-3">
          <label>Status</label>
          <select name="status" class="form-control" required>
              <option value="present">Present</option>
              <option value="absent">Absent</option>
              <option value="online">Online</option>
              <option value="excused">Excused</option>
          </select>
      </div>

      <div class="mb-3">
          <label for="memberSearch" class="form-label">Search Members</label>
          <input type="text" id="memberSearch" class="form-control" placeholder="Type a nameâ€¦">
          <div id="membersVisibleCount" class="form-text"></div>
      </div>

      <!-- Member Checkboxes -->
      <div id="membersList" class="border rounded p-2" style="max-height:420px; overflow-y:auto;">
          {% for member in members %}
          <div class="form-check member-item" style="display:none;">
              <input class="form-check-input" type="checkbox" name="member_ids" value="{{ member.id }}" id="member{{ member.id }}">
              <label class="form-check-label" for="member{{ member.id }}">
                  {{ member.first_name }} {{ member.last_name }}
              </label>
          </div>
          {% endfor %}
      </div>   

      <!-- Selected summary -->
      <div class="mt-3">
          <strong>Selected Members (<span id="selectedCount">0</span>):</strong>
          <ul id="selectedMembers" class="list-unstyled small mb-0"></ul>
      </div>

      <div class="mb-3 mt-3">
          <textarea name="remarks" class="form-control" placeholder="Remarks (optional)"></textarea>
      </div>

      <!-- Submit button -->
      <div class="mt-3">
          <button type="submit" class="btn btn-success" >Save Attendance</button>
      </div>
  </form>
</div></div>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
      const searchInput = document.getElementById("memberSearch");
      const memberItems = document.querySelectorAll(".member-item");
      const countDisplay = document.getElementById("membersVisibleCount");
      const selectedMembersList = document.getElementById("selectedMembers");
      const selectedCount = document.getElementById("selectedCount");

      // Filter members while typing
      searchInput.addEventListener("input", function () {
          const query = this.value.trim().toLowerCase();
          let visibleCount = 0;

          memberItems.forEach(item => {
              const label = item.querySelector("label").textContent.toLowerCase();
              if (query && label.includes(query)) {
                  item.style.display = "block";
                  visibleCount++;
              } else {
                  item.style.display = "none";
              }
          });

          countDisplay.textContent = query
              ? (visibleCount > 0 ? `${visibleCount} member(s) found` : "No matches found")
              : "";
      });

      // Track selections
      memberItems.forEach(item => {
          const checkbox = item.querySelector("input");
          checkbox.addEventListener("change", updateSelected);
      });

      function updateSelected() {
          selectedMembersList.innerHTML = "";
          const selected = document.querySelectorAll(".member-item input:checked");
          selected.forEach(cb => {
              const label = cb.parentElement.querySelector("label").textContent;
              const li = document.createElement("li");
              li.textContent = label;
              selectedMembersList.appendChild(li);
          });
          selectedCount.textContent = selected.length;
      }
  });
  </script>
  {% endblock %}
